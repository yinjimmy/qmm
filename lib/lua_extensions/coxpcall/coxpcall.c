
/* coxpcall.c */

#include "lua.h"
#include "lauxlib.h"
#include "coxpcall.h"

/* coxpcall, coxpcall.lua */
static const unsigned char lua_m_coxpcall[] = {
27,76,74,1,2,63,2,0,4,0,4,1,9,51,0,2,0,52,1,0,0,37,2,1,0,67,3,0,0,61,1,1,2,58,1,3,0,67,1,0,0,60,1,0,0,72,0,2,0,6,110,1,0,0,6,35,11,115,101,108,101,99,116,3,128,128,192,153,4,182,1,2,3,8,1,6,0,31,14,0,2,0,84,3,10,128,41,3,1,0,16,4,0,0,52,5,0,0,55,5,1,5,16,6,1,0,67,7,3,2,62,5,3,2,67,6,3,0,61,4,1,0,69,3,1,0,52,3,2,0,55,3,3,3,16,4,1,0,62,3,2,2,7,3,4,0,84,3,9,128,43,3,0,0,16,4,0,0,16,5,1,0,52,6,2,0,55,6,5,6,67,7,3,0,61,6,0,0,63,3,2,0,84,3,3,128,41,3,2,0,67,4,3,0,69,3,1,0,71,0,1,0,0,128,10,121,105,101,108,100,14,115,117,115,112,101,110,100,101,100,11,115,116,97,116,117,115,14,99,111,114,111,117,116,105,110,101,14,116,114,97,99,101,98,97,99,107,10,100,101,98,117,103,62,2,2,8,1,2,0,9,43,2,0,0,16,3,0,0,16,4,1,0,52,5,0,0,55,5,1,5,16,6,1,0,67,7,2,0,61,5,1,0,63,2,2,0,1,128,11,114,101,115,117,109,101,14,99,111,114,111,117,116,105,110,101,47,0,0,5,3,1,0,8,43,0,0,0,43,1,1,0,43,2,2,0,39,3,1,0,43,4,2,0,55,4,0,4,62,1,4,0,63,0,0,0,0,192,2,0,4,192,6,110,125,3,2,8,4,3,0,23,43,2,0,0,52,3,0,0,55,3,1,3,16,4,0,0,62,2,3,3,14,0,2,0,84,4,10,128,43,4,1,0,67,5,2,0,61,4,0,2,49,5,2,0,52,6,0,0,55,6,1,6,16,7,5,0,62,6,2,2,16,3,6,0,48,4,0,128,43,4,3,0,16,5,1,0,16,6,3,0,67,7,2,0,48,0,0,128,63,4,2,0,2,192,4,192,5,192,0,128,0,11,99,114,101,97,116,101,14,99,111,114,111,117,116,105,110,101,15,2,1,2,0,0,0,2,67,1,1,0,69,1,0,0,38,2,1,5,1,1,0,5,52,1,0,0,16,2,0,0,43,3,0,0,67,4,1,0,63,1,2,0,6,192,13,99,111,120,112,99,97,108,108,248,1,3,0,9,0,17,0,41,52,0,0,0,7,0,1,0,84,0,10,128,52,0,2,0,53,0,3,0,52,0,4,0,53,0,5,0,51,0,6,0,52,1,2,0,58,1,2,0,52,1,4,0,58,1,4,0,48,0,27,128,42,0,1,0,52,2,2,0,52,3,4,0,52,4,7,0,55,4,8,4,14,0,4,0,84,5,1,128,49,4,9,0,52,5,7,0,55,5,10,5,14,0,5,0,84,6,1,128,52,5,10,0,49,1,11,0,49,0,12,0,49,6,13,0,53,6,5,0,49,6,14,0,49,7,15,0,53,7,3,0,51,7,16,0,52,8,3,0,58,8,2,7,52,8,5,0,58,8,4,7,48,0,0,128,72,7,2,0,72,0,2,0,1,0,0,0,0,0,0,0,11,117,110,112,97,99,107,0,9,112,97,99,107,10,116,97,98,108,101,1,0,0,13,99,111,120,112,99,97,108,108,11,120,112,99,97,108,108,12,99,111,112,99,97,108,108,10,112,99,97,108,108,12,76,117,97,32,53,46,50,13,95,86,69,82,83,73,79,78,0,
};



int luaopen_lua_m_coxpcall(lua_State *L) {
    int arg = lua_gettop(L);
    luaL_loadbuffer(L,
                    (const char*)lua_m_coxpcall,
                    sizeof(lua_m_coxpcall),
                    "coxpcall.lua");
    lua_insert(L,1);
    lua_call(L,arg,1);
    return 1;
}


static luaL_Reg coxpcall_modules[] = {
    {"coxpcall", luaopen_lua_m_coxpcall},
    {NULL, NULL}
};

void luaopen_coxpcall(lua_State* L)
{
    luaL_Reg* lib = coxpcall_modules;
    for (; lib->func; lib++)
    {
        lua_getglobal(L, "package");
        lua_getfield(L, -1, "preload");
        lua_pushcfunction(L, lib->func);
        lua_setfield(L, -2, lib->name);
        lua_pop(L, 2);
    }
}
